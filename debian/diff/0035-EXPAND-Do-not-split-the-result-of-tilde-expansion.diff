From 8026601c747a22ae1266e92dbbaf0c2b4472a757 Mon Sep 17 00:00:00 2001
From: Jilles Tjoelker <jilles@stack.nl>
Date: Thu, 10 Mar 2011 17:16:13 +0800
Subject: [EXPAND] Do not split the result of tilde expansion

A tilde expansion generates a valid pathname. Splitting it using IFS
either leaves it unchanged or changes it to something unintended.

This fixes FreeBSD sh test expansion/tilde1.0 and does not change the
outcome of the other tests.

This fixes Debian bug #601096.

Example:
  IFS=m HOME=/tmp; printf "%s\n" ~

Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
(cherry picked from commit 834629283f6c629a4da05ef60bae9445c954a19a)

Signed-off-by: Jonathan Nieder <jrnieder@gmail.com>
---
 ChangeLog    |    1 +
 src/expand.c |    3 ---
 2 files changed, 1 insertions(+), 3 deletions(-)

diff --git a/ChangeLog b/ChangeLog
index 320b6ec..f32dced 100644
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,6 +1,7 @@
 2011-03-10  Jilles Tjoelker <jilles@stack.nl>
 
 	* Replace GPL noclobberopen code with the FreeBSD version.
+	* Do not split the result of tilde expansion.
 
 2010-11-28  Maciej Å»enczykowski <zenczykowski@gmail.com>
 
diff --git a/src/expand.c b/src/expand.c
index 1b77b7c..6bee5c5 100644
--- a/src/expand.c
+++ b/src/expand.c
@@ -364,7 +364,6 @@ exptilde(char *startp, char *p, int flag)
 	char *name;
 	const char *home;
 	int quotes = flag & QUOTES_ESC;
-	int startloc;
 
 	name = p + 1;
 
@@ -393,9 +392,7 @@ done:
 	if (!home || !*home)
 		goto lose;
 	*p = c;
-	startloc = expdest - (char *)stackblock();
 	strtodest(home, SQSYNTAX, quotes);
-	recordregion(startloc, expdest - (char *)stackblock(), 0);
 	return (p);
 lose:
 	*p = c;
-- 
1.7.4.1

